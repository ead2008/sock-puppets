<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Guestbook — Admin</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
body { font-family: "Courier New", monospace; background:#070707; color:#efe7e7; margin:0; padding:20px; }
.container { max-width:900px; margin:0 auto; }
h1 { color:#cc0000; }
.btn { background:#cc0000; color:#fff; border:none; padding:8px 12px; cursor:pointer; font-weight:bold; }
pre { background:#0b0b0b; padding:12px; border:1px solid #222; white-space:pre-wrap; word-break:break-word; }
</style>
</head>
<body>
<div class="container">
  <h1>Guestbook — Admin</h1>
  <div style="margin-bottom:12px;">
    <button id="refreshBtn" class="btn">Refresh Entries</button>
    <button id="clearBtn" class="btn" style="background:#333; margin-left:8px;">Clear All Entries</button>
  </div>
  <h2>Logged Entries (user_texts.txt)</h2>
  <pre id="logArea">Loading...</pre>
</div>

<script>
const logArea = document.getElementById('logArea');
const refreshBtn = document.getElementById('refreshBtn');
const clearBtn = document.getElementById('clearBtn');

async function loadEntries() {
  try {
    const r = await fetch('/admin/entries', { credentials: 'same-origin' });
    if (!r.ok) throw new Error('Failed to fetch entries');
    const text = await r.text();
    logArea.textContent = text || '(no entries)';
  } catch (e) {
    logArea.textContent = 'Error loading entries: ' + e.message;
  }
}

refreshBtn.addEventListener('click', loadEntries);

clearBtn.addEventListener('click', async () => {
  if (!confirm('Delete all guestbook entries?')) return;
  try {
    const r = await fetch('/admin/clear', { method: 'POST' });
    const data = await r.json();
    if (data && data.success) {
      loadEntries();
      alert('Entries cleared.');
    } else {
      alert('Failed to clear entries.');
    }
  } catch (e) {
    alert('Network error clearing entries.');
  }
});

loadEntries();
</script>
</body>
</html>
